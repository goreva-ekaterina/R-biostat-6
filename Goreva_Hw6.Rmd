---
title: "Горева Е. ДЗ 6"
output: html_document
date: "2024-04-17"
---
Библиотеки
```{r}

```
## Задание 1:  
Рассчитайте выборку для исследования терапевтической эквивалентности для двухпериодного cross-over дизайна. Из предыдущих исследований известно, что дисперсия составляет 20% ( = 0.20), а разница средних составляет −10% (). Клиницисты сообщают нам, что клинически значимая разница составляет 25% ( = 0.25). 
От спонсора исследований:  мощность - 80% , а уровень значимости — 5%, ожидаемый drop-out rate - 10%.

```{r}
# клиническая значимая разница
delta <- 0.25
# дисперсия
sd <- 0.20
# разница средних 
def_mean<- 0.1
# drop-out rate
dor <- 0.1
# уровень значимости  
alpha <- 0.05
# мощность
beta <- 0.8
```

```{r}
# вычисляем объем выборки
# нам потребуется z_alpha2 - квантиль нормльного распределения при уроване значимости альфа/2
# также находим z_beta - квантиль нормального распределения для мощности
z_alpha2 <- abs(qnorm(1 - alpha/2))
z_beta <- abs(qnorm(beta))

# вычисляем объем выборки
nom <- (z_alpha2 + z_beta)^2 * sd^2
denom <- (2 * (delta - abs(def_mean))^2)
size <- nom/denom
# объем выборки с округлением в большую сторону
ceiling(size)
```
```{r}
# размер выборки с учетом drop-out rate
size_dor <- size / (1 - dor)
# округлили в большую сторону
ceiling(size_dor)
```
```{r}
# с учетом дизайна нам потребуетс 2 таких объема 
ceiling(size_dor*2)
```
Итого, размер выборки каждой группы - 8 человек. Всего для исследования нужно 16 человек. 

## Задание 2:   
Рассчитайте выборку для гипотезы non-inferiority для двухвыборочного параллельного дизайна. Пусть клинически значимая разница  = -0.1, то есть мы ожидаем разницу не меньше 10%, а долю ответов для тестового препарата  = 0.65, в то время как нам известно из предыдущих исследований, что доля ответов у препарата сравнения составляет  = 0.85. Соотношение групп равно  = 1.
```{r}
# меняем значения параметров под условия 
# клинически значимая разница
delta <- -0.1
# доля ответов тестового препарата
resp_test <- 0.65
#доля ответов препарата сравнения
resp_contr <- 0.85
```

```{r}
# объем выборки 
nom <- (z_alpha2 + z_beta)^2 * (resp_contr * (1 - resp_contr) + resp_test *(1 - resp_test))
denom <- (resp_contr - resp_test - delta)^2
size <- nom/denom
# объем выборки с округлением
ceiling(size)
```
```{r}
# размер выборки с учетом drop-out rate
size_dor <- size / (1 - dor)
# округлили в большую сторону
ceiling(size_dor)
```
```{r}
# с учетом дизайна нам потребуетс 2 таких объема для всего исследования
ceiling(size_dor*2)
```
Итого, размер выборки каждой группы - 35 человек. Всего для исследования, описанного в задаче 2 нужно 69 человек. 

## Задача 3
Рассчитайте выборку для гипотезы equality для следующего исследования. Мы хотим сравнить новую терапию инфекции, присоединяющейся в больничных условиях у пациентов с ожогами, с золотым стандартом, основываясь на данных, анализируемых с помощью регрессии Кокса. Пусть отношение рисков «золотой стандарт / новая терапия», hazard ratio, HR = 2. Мы предполагаем, что 80% пациентов (d= 0.8) могут столкнуться с этим заболеванием. Соотношения групп терапии равны (p1=p2=0,5).
```{r}
# новые вводные
# отношение рисков
HR <- 2
# процент пациентов, которые столкнутся с заболеванием
d <- 0.8
# соотношение групп
p1 <- 0.5
p2 <- 0.5
```

```{r}
# объем выборки 
nom <- (z_alpha2 + z_beta)^2
denom <- (log(HR))^2 * p1 * p2 * d
size <- nom / denom
ceiling(size)
```
```{r}
# с учетом drop_out_rat
size_dor <- size / (1 - dor)
ceiling(size_dor)

```
```{r}
# всего для исследования 
ceiling(size_dor*2)
```
Итого, размер выборки каждой группы - 91 человек. Всего для исследования, описанного в задаче 3 нужно 182 человек. 
